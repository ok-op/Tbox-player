<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare Workers Deployment Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #007bff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        code {
            display: block;
            background: #282c34;
            color: #61dafb;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .highlight {
            color: #ff4500;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸš€ Cloudflare Workers Deployment Guide</h1>

        <h2>ðŸ“Œ Step 1: Log in to Cloudflare Workers</h2>
        <p>Go to <a href="https://workers.cloudflare.com/" target="_blank">Cloudflare Workers</a> and log in to your account.</p>

        <h2>ðŸ“Œ Step 2: Create a New Worker</h2>
        <p>In the Cloudflare Workers dashboard, click on <b>"Create a Service"</b> to create a new worker.</p>

        <h2>ðŸ“Œ Step 3: Copy and Paste the Code into the Worker</h2>
        <code id="worker-code">
// worker.js - Cloudflare Worker Script
export default {
  async fetch(request, env) {
    const url = new URL(request.url);
    
    // âœ… List of available models
    const models = {
      "realistic_vision": "SG161222/Realistic_Vision_V5.1_noVAE",
      "dreamshaper": "Lykon/DreamShaper-v7",
      "sdxl": "stabilityai/stable-diffusion-xl-base-1.0",
      "deliberate": "XpucT/Deliberate",
      "anything_v5": "stabilityai/stable-diffusion-2-1",
      "protogen": "darkstorm2150/Protogen_x5.8",
      "flux": "black-forest-labs/FLUX.1-dev"  // âœ… Newly added model
    };

    // âœ… Show model list if model=list
    if (url.searchParams.get("model") === "list") {
      return new Response(JSON.stringify(models, null, 2), {
        headers: { "Content-Type": "application/json", "Access-Control-Allow-Origin": "*" }
      });
    }

    let modelKey = url.searchParams.get('model') || Object.keys(models)[Math.floor(Math.random() * Object.keys(models).length)];
    let model = models[modelKey] || models["realistic_vision"];
    
    const prompt = url.searchParams.get('input') || 'A futuristic city at sunset';
    const width = parseInt(url.searchParams.get('width')) || 1024;
    const height = parseInt(url.searchParams.get('height')) || 1024;
    const guidance_scale = parseFloat(url.searchParams.get('scale')) || 10;

    if (!env.HUGGINGFACE_TOKEN) {
      return new Response(JSON.stringify({ error: "Missing Hugging Face API token" }), {
        status: 401,
        headers: { "Content-Type": "application/json", "Access-Control-Allow-Origin": "*" }
      });
    }

    const requestBody = {
      inputs: prompt,
      parameters: { width: width, height: height, guidance_scale: guidance_scale }
    };

    try {
      const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
        method: "POST",
        headers: { "Authorization": `Bearer ${env.HUGGINGFACE_TOKEN}`, "Content-Type": "application/json" },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        const errorResponse = await response.json();
        return new Response(JSON.stringify({ error: "Failed to fetch from Hugging Face API", details: errorResponse }), {
          status: response.status,
          headers: { "Content-Type": "application/json", "Access-Control-Allow-Origin": "*" }
        });
      }

      const imageBuffer = await response.arrayBuffer();
      return new Response(imageBuffer, {
        headers: {
          "Content-Type": "image/png",
          "Access-Control-Allow-Origin": "*",
          "Access-Control-Allow-Methods": "GET, HEAD, OPTIONS"
        }
      });

    } catch (error) {
      return new Response(JSON.stringify({ error: "Internal Server Error", details: error.message }), {
        status: 500,
        headers: { "Content-Type": "application/json", "Access-Control-Allow-Origin": "*" }
      });
    }
  }
};
        </code>
        <button onclick="copyToClipboard('worker-code')">ðŸ“‹ Copy Code</button>

        <h2>ðŸ“Œ Step 4: Save and Deploy the Worker</h2>
        <p>Click "Save" and then "Deploy" to make your worker live.</p>

        <h2>ðŸ“Œ Step 5: Use the API URL</h2>
        <p>You can now use the Worker URL to make API calls. Example:</p>
        <code>https://your-worker-name.YOUR_SUBDOMAIN.workers.dev/?input=Sunset&model=dreamshaper</code>

        <h2>ðŸ“Œ Step 6: Set Up Hugging Face API Token</h2>
        <p>
            To use this API, you need a <b>Hugging Face API Token</b>. Follow these steps:
        </p>
        <ol>
            <li>Go to <a href="https://huggingface.co/settings/tokens" target="_blank">Hugging Face API Tokens</a></li>
            <li>Log in or create an account</li>
            <li>Click "New token" and create a token with <b>read access</b></li>
            <li>Copy the token</li>
        </ol>

        <h3>ðŸ“Œ How to Add the API Token in Cloudflare Workers</h3>
        <p>Once you have the Hugging Face token, follow these steps:</p>
        <ol>
            <li>Open your Cloudflare Worker dashboard</li>
            <li>Go to your deployed Worker</li>
            <li>Click on <b>Variables</b> (Environment Variables)</li>
            <li>Add a new variable:
                <code>HUGGINGFACE_TOKEN = your_api_token_here</code>
            </li>
            <li>Click "Save and Deploy"</li>
        </ol>

        <h2>ðŸŽ‰ Your API is Now Ready!</h2>
        <p>Your AI Image Generator is now live on Cloudflare Workers! ðŸš€</p>
    </div>

    <script>
        function copyToClipboard(elementId) {
            var text = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Code copied successfully!");
            });
        }
    </script>

</body>
</html>
